---
title: "3次元回転は射影空間"
author: "ryamada"
date: "2019年9月22日"
output: html_document
---

```{r setup, include=FALSE}
library(knitr)
library(rgl)
knit_hooks$set(webgl = hook_webgl)
```

## 回転同一視のために回転が作る多様体を考えたい

### ３次元回転は３次元多様体

３つの回転角で回転が指定できるからもわかる。

単位四元数
$$
q = \cos{\frac{\theta}{2}} \times \mathbf{1} + \sin{\frac{\theta}{2}} \times (\alpha \mathbf{i} + \beta \mathbf{j} + \gamma \mathbf{k})\\
\alpha^2 + \beta^2 + \gamma^2 = 1
$$
が、回転軸$(\alpha,\beta,\gamma)$に関する、角度$\theta$の回転を表し、３次元空間の点 $(x,y,z)$に対応する四元数$p = x \mathbf{i} + y \mathbf{j} + z \mathbf{k}$を $\bar{q} p q$に移すことからも、

自由度が３であることがわかる。

### 射影空間$RP^3$

少し見方を変える。

回転軸を３次元空間の単位ベクトルとする。

回転角を$-\pi ~ \pi$とし、この回転角を回転軸方向ベクトルに掛けると、３次元回転は半径$\pi$の３次元球全体になる。

ここで、任意の軸の回転角$-\pi$の回転とその軸の回転角$\pi$の回転とは、同じ回転であるから、３次元回転は、３次元空間の半径$\pi$の球に対応付けられつつ、その球面の対蹠点同士は「同一視」される。

同一視された点を「張り合わせる」ことにすると、ユークリッド空間に埋め込むことはできないが、このような空間は実射影空間であることが知られている。

### グラフでなら射影空間も離散的に表せる

グラフは頂点を辺で結んだ構成になっており、「隣同士関係」を表したものなので、位相を表せる。

したがって、３次元回転(４次元単位球面)上に十分にたくさんの点を取り、それらの近いもの同士を辺で結んでできるグラフは、(抽象的に)３次元回転が作る$RP^3$を表している。

４次元空間の単位球面を覆うグラフ、$RP^3$を２つ張り合わせたものになっているが、このグラフをそのまま使っても、用は足りるかもしれない…

### ２つの球面分布等のアラインメントの良さを、$RP^3$に対応するグラフに配置する

今、２つのオブジェクトがあって、その片方の形をいろいろに回転させて、もう片方の形とのDissimilarityをスカラーで表したとする。

３次元球面上の分布のDissimilarityは岡田大瑚さんのプロジェクト。

これにより、$RP^3$に対応するグラフの頂点にスカラー値が割り当てられたから、グラフ上の場ができた。

グラフ上の場には、グラフ上の勾配もある。和田拓哉さんがやっているらラプラシアンはグラフ勾配の話。

最適回転探しとは、このグラフにおけるスカラー場の最大値・最小値探し。

より簡単には、隣り合った頂点のスカラー値を比較して、その大小に応じて辺に向きを入れると、スカラー場の「流れ」の終点(極点)などが簡単に見つかる。

もしくは、この有向グラフの様相自体が、２つの形・分布の違いの特徴抽出になっているともいえる。

## 少し、Rのコード

```{r}
library(onion)
library(igraph)
library(rgl)
library(geometry)

# 4次元単位球面乱点～３次元回転の発生
n <- 500
dm <- 4
R <- matrix(rnorm(n*dm),ncol=dm)
R <- R/sqrt(apply(R^2,1,sum))
# 回転四元数
#rot.q <- R[,1] + Hi * R[,2] + Hj * R[,3] + Hk * R[,4]


# 凸包を作れば、３次元回転の近いもの同士を結んだグラフになる
h <- convhulln(R)

# この凸包から、エッジを取り出せば、グラフにできる

el <- rbind(h[,c(1,2)],h[,c(1,3)],h[,c(1,4)],h[,c(2,3)],h[,c(2,4)],h[,c(3,4)])
#el <- rbind(h[,c(1,2)],h[,c(1,3)],h[,c(2,3)])
# エッジのユニークをとる
el <- unique(t(apply(el,1,sort)))
g <- graph.edgelist(el,directed=FALSE)
plot(g,vertex.label="",vertex.size=0.1)
```

### ３次元回転を格子的に作るのもあり

３次元球面にフィボナッチらせん・格子により、ほぼ均等分布を作り、回転角を等間隔で作ることで、「格子状」の３次元回転を作ってやるのもあり

```{r,webgl=TRUE}
# Nは乱点の数を決める引数
# f1 は黄金比の値をデフォルトとする値。この値を黄金比から変えると格子としての良い性格がなくなる
# k=1をデフォルトとし、フィボナッチ格子を描くためにはk=1。ただし、その背景にあるらせんを描くためにはこの値をいじって、らせん上の点の数を増やす必要がある
fib.lattice.S2 <-function(N,f1=(sqrt(5)+1)/2,k=1){
	f2 <- f1-1 # 黄金比はx^2-x-1=0の１つの根。もう１つの根を取り出す
	#P <- 2*N+1
	i <- seq(from=-N, to=N,by=k)
	theta <- asin(2*i/(2*N+1))
	phi <- 2*pi*i*f2
	x <- cos(theta)*cos(phi)
	y <- cos(theta)*sin(phi)
	z <- sin(theta)
	return(cbind(x,y,z))
}

library(rgl)


# フィボナッチ格子点の座標
N <- 100
fl <- fib.lattice.S2(N)


plot3d(fl)
```


